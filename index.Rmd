---
title:  'Computational Musicology'
author: 'Dewi Boessen'
date:   'February--March 2020'
output: 
    flexdashboard::flex_dashboard:
        storyboard: true
        theme: simplex
---

```{r setup}
# In order to use these packages, we need to install flexdashboard, plotly, and Cairo.
library(tidyverse)
library(plotly)
library(spotifyr)
library(compmus)
source('spotify.R')
```

### *1000 Sterre* is repetitive 

```{r}

sterre <- 
    get_tidy_audio_analysis('2belCUvfatuYkLvppS4EVV') %>% 
    compmus_align(bars, segments) %>% 
    select(bars) %>% unnest(bars) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'rms', norm = 'euclidean')) %>% 
    mutate(
        timbre = 
            map(segments, 
                compmus_summarise, timbre, 
                method = 'mean'))


sterre %>% 
    compmus_self_similarity(timbre, 'cosine') %>% 
    ggplot(
        aes(
            x = xstart + xduration / 2, 
            width = xduration,
            y = ystart + yduration / 2,
            height = yduration,
            fill = d)) + 
    geom_tile() +
    coord_fixed() +
    scale_fill_viridis_c(option = 'E', guide = 'none') +
    theme_classic() +
    labs(x = '', y = '') + ggtitle("Timbre")


```

***

For the self similarity matrices, I choose the song *1000 Sterre* by Bjorn & Mieke. It is one of the song I like the most. There is a clear pattern visable and it shows that the song is repetitive. I also choose bars as level of detail, because this gave the most clear matrix.

### Introduction

I would like to compare Dutch Carnival Music to Today's Top Hits. I think this is interesting because, in my opinion, carnival music always gets people in a good mood. I also think it's interesting because the genres, subjects and even the vibes are very different. A lot of people can sing along to the songs in both the playlists. I'm very curious to see what's the difference between the two.

For my corpus, I used different Spotify playlists, playlists like Vastelaovend 2020 and Carnaval 2020 hits for the carnival music and Nederlandse Hits 2020 for the songs that are popular in the Netherlands at the moment. The playlists consist of songs that are currently most popular. As measured by Spotify, carnival music has a much higher valence (M = 0.768, SD = 0.195) than the top hits (M = 0.495, SD = 0.208). The mode of carinals music, overall, seems to be more major (M = 0.963, SD = 0.189) than the top hits (M = 0.54, SD = 0.503).

The carnival music also has a much higher energy (M = 0.792, SD = 0.120), compared to the hits (M = 0.587, SD = 0.158). Interesting to see is that the liveness of today's hits (M = 1.73, SD = 0.142) is much higher than the carnival music (M = 0.222, SD = 0.161). I think these findings are also something to look into, because maybe it is possible to find a reason for it.


***

Carnival, in Dutch Carnaval or Vastelaovend, is a holiday consisting of three days full of dressing up and drinking lots and lots of alcohol. (here needs some more information)


### Carnaval Music Is More Positive

```{r}

limburg <- get_playlist_audio_features('Henk Theunissen', '1xQvcNKQVMGOsuZK6nXx9a')
brabant <- get_playlist_audio_features('Sander van Berkel', '4rghKMRumKCenvOxbmjwmL')

carnaval <-
  limburg %>% mutate(playlist = "Limburg") %>%
  bind_rows(brabant %>% mutate(playlist = "Brabant"))

todayshits <- get_playlist_audio_features('Soave', '5iKY71w39zY0Bs6kcmOK2Z')

muziek <- carnaval %>% mutate(playlist = "Carnaval") %>% bind_rows(todayshits %>% mutate(playlist = "Hits in Nederland 2020"))


vergelijking <- muziek %>%                       # Start with awards.
  mutate(
    mode = ifelse(mode == 0, 'Minor', 'Major')
  ) %>%
  ggplot(                      # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = loudness,
      colour = mode, label = track.name
    )
  ) +
  geom_point() +               # Scatter plot.
  geom_rug(size = 0.1) +       # Add 'fringes' to show data distribution.
  facet_wrap(~ playlist) +     # Separate charts per playlist.
  scale_x_continuous(          # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),  # Use grid-lines for quadrants only.
    minor_breaks = NULL      # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(          # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_brewer(         # Use the Color Brewer to choose a palette.
    type = "qual",           # Qualitative set.
    palette = "Reds"       # Name of the palette is 'Paired'.
  ) +
  scale_size_continuous(       # Fine-tune the sizes of each point.
    trans = "exp",           # Use an exp transformation to emphasise loud.
    guide = "none"           # Remove the legend for size.
  ) +
  theme_light() +              # Use a simpler them.
  labs(                        # Make the titles nice.
    x = "Valence",
    y = "Energy",
    colour = "Mode"
  )

ggplotly(vergelijking)

```

***

In the visualisation, you can see that the popular songs in the Netherlands are more spread over the axis. The carnival music tends to have a very high energy and a high valence. Ofcourse, there are some outliers. But overall, it seems like the carnival music is much more energetic and positive than the hitsongs. 

I used a couple of Spotify's features. On the *x* axis, 'valance' is shown and on the *y* axis shows 'energy'. The colour of the dots clarifies whether the songs are in a major or in a minor mode and the size of the dots gives us an idea about the loudness of the songs in the playlists.

The music tends to be happier and this could contribute to the fact that when celebrating carnival, most people are in a very good mood. But ofcourse, we can't forget the large consumption of alcoholic drinks.


### Limburg vs. Brabant

```{r}
beppie <- 
    get_tidy_audio_analysis('4M2tPMJdLldCKDhBZGLR9t') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)
rene <- 
    get_tidy_audio_analysis('7drS8Zj5rq3usSZY1e5crj') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)

beppie %>% 
    mutate(pitches = map(pitches, compmus_normalise, 'euclidean')) %>% 
    compmus_gather_chroma %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = pitch_class, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    theme_minimal()

rene %>% 
    mutate(pitches = map(pitches, compmus_normalise, 'euclidean')) %>% 
    compmus_gather_chroma %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = pitch_class, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    theme_minimal()

compmus_long_distance(
    beppie %>% mutate(pitches = map(pitches, compmus_normalise, 'chebyshev')),
    rene %>% mutate(pitches = map(pitches, compmus_normalise, 'chebyshev')),
    feature = pitches,
    method = 'euclidean') %>% 
    ggplot(
        aes(
            x = xstart + xduration / 2, 
            width = xduration,
            y = ystart + yduration / 2,
            height = yduration,
            fill = d)) + 
    geom_tile() +
    scale_fill_continuous(type = 'viridis', guide = 'none') +
    labs(x = 'Beppie Kraft', y = 'Rene Schuurmans') +
    theme_minimal()

```

***

Because there is a language difference in the music from Brabant and Limburg, I thought it'd be interesting to compare a song. Sometimes artists make covers of songs that are popular in the other county. In this case I choose the song *Laot de zon in dien hart* and *Laat de zon in je hart*, which means let the sun into your heart. When you listen to the tracks, the two versions seem to be very alike.

```{r}

beppie <- get_track_audio_features('4M2tPMJdLldCKDhBZGLR9t')
rene <- get_track_audio_features('7drS8Zj5rq3usSZY1e5crj')

``` 
|Audio Feature    |Rene Schuurmans|Beppie Kraft|
|-----------------|---------------|------------|
|Danceability     |0.731	        |0.786       |
|Energy	          |0.807	        |0.791       |
|Key	            |9	            |3           |
|Loudness         |-5.508	        |-6.294      |
|Mode	            |1              |1           |
|Speechiness      |0.0289	        |0.0279      |
|Acousticness	    |0.636          |0.431       |
|Instrumentalness	|0	            |0           |
|Liveness	        |0.275	        |0.332       |
|Valence	        |0.963	        |0.939       |
|Tempo	          |123.986	      |123.94      |

As becomes clear from the table, the only big difference between the two songs is the 'loudness' feature and the key. The version of Rene Schuurmans is in G# major and the version of Beppie Kraft is in D major.

I think the reason that the graph is so blurry is because the songs are in different keys, but I am not sure and I don't know how to fix it.


